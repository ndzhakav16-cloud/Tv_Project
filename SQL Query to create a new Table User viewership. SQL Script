CREATE OR REPLACE TABLE bright_tv_user_viewership AS(

SELECT bright_tv_user_profiles.UserID ,
       bright_tv_user_profiles.Gender,
       bright_tv_user_profiles.Race,
       bright_tv_user_profiles.Age,
       bright_tv_user_profiles.Province,
       bright_tv_viewership.Channel2,
       bright_tv_viewership.RecordDate2, 
       bright_tv_viewership.Duration2


 
FROM Workspace.default.bright_tv_user_profiles 
JOIN Workspace.default.bright_tv_viewership 
 ON bright_tv_user_profiles.userID=bright_tv_viewership.UserID);      

 SELECT
       CHANNEL2,
       AGE,
       GENDER,
       PROVINCE,
       RACE,
       COUNT(DISTINCT USERID) AS total_viewers,
       AVG(DURATION2) AS avg_duration_minutes,
       COUNT(CHANNEL2) AS total_views_PerChannel,
       AVG(DURATION2) AS avg_duration ,
       COUNT( RACE) AS Viewers_Per_Race

FROM bright_tv_user_viewership
GROUP BY ALL
ORDER BY total_viewers DESC;
