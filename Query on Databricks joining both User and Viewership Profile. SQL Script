SELECT
     bright_tv_user_profiles.UserID,
      bright_tv_user_profiles.Name,                      
      bright_tv_user_profiles.Surname,
      bright_tv_user_profiles.Email,
      bright_tv_user_profiles.Gender,
      bright_tv_user_profiles.Race,
      bright_tv_user_profiles .Age,
      bright_tv_user_profiles.Province,
      bright_tv_viewership.Channel2 AS Channel2,
      bright_tv_viewership.UserID AS UserID2,
      bright_tv_viewership.RecordDate2 AS RecordDate2,
      bright_tv_viewership.Duration2 AS Duration2,

    CASE 
      WHEN AGE BETWEEN 0 AND 12 THEN 'Kids'
      WHEN AGE BETWEEN 13 AND 17 THEN 'Child'
      WHEN AGE BETWEEN 18 AND 35 THEN 'Youth'
      WHEN AGE BETWEEN 36 AND 45 THEN 'Young Adults'
      WHEN AGE BETWEEN 46 AND 55 THEN 'Adults'
 ELSE 'Elders'
 END AS AgeGroup,



CASE
  WHEN
  SUM(EXTRACT(HOUR FROM Bright_tv_viewership.Duration2) *3600 
+ EXTRACT(MINUTE FROM Bright_tv_viewership.Duration2)*60 
+ EXTRACT(SECOND FROM Bright_tv_viewership.Duration2)) <=50 THEN'least Viewers'

  WHEN 
  SUM(Bright_tv_viewership.Duration2) *3600 
+ EXTRACT(MINUTE FROM Bright_tv_viewership.Duration2)*60 
+ EXTRACT(SECOND FROM Bright_tv_viewership.Duration2) <=150 THEN'Nornal_Viewers'
  ELSE 'Most_Viewers'
END AS Viewers, 
   

AVG(CAST(bright_tv_user_profiles .Age AS BIGINT)) AS AVG_MostViewing_Age,
SUM(CAST(Bright_tv_viewership.Duration2 AS BIGINT)) AS Total_Duration,




SUM(EXTRACT(HOUR FROM Bright_tv_viewership.Duration2) *3600 
+ EXTRACT(MINUTE FROM Bright_tv_viewership.Duration2)*60 
+ EXTRACT(SECOND FROM Bright_tv_viewership.Duration2)) AS Total_Seconds,





 DATE(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm')) AS Date_Wached,
 DAYNAME(DATE(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'))) AS Day_Name,
 DATE_FORMAT(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'),'MMMM') AS Month_Name,
 DAYOFMONTH(DATE(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'))) AS Day_of_Month,
 YEAR(DATE(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'))) AS Year,
 YEAR(DATE(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'))) AS Year2,
 DATE_FORMAT(TRY_TO_TIMESTAMP(Bright_tv_viewership.RecordDate2,'M/d/yyyy HH:mm'),'HH') AS Hour_of_Day



   FROM Workspace.default.bright_tv_user_profiles
   JOIN Workspace.default.bright_tv_viewership
   ON bright_tv_user_profiles.userID=bright_tv_viewership.UserID


WHERE 

  bright_tv_viewership.Channel2 IN ('BBC','CNN','FOX', 'HBO','HISTORY','NBC','PBS','TBS', 'TNT','TRAVEL', 
 'USA','VIA', 'WGN','CNN', 'FOX', 'HBO', 'HISTORY','NBC', 'PBS', 'TBS')
GROUP BY ALL; 
